name: Manual Test

on:
  workflow_dispatch:
    inputs:
      base_ref:
        description: 'Base reference to compare against (e.g., HEAD^, main, commit SHA)'
        required: false
        default: 'HEAD^'
        type: string
      head_ref:
        description: 'Head reference to checkout (e.g., HEAD, main, commit SHA)'
        required: false
        default: 'HEAD'
        type: string

permissions: {}

jobs:
  test-true:
    name: Test True (Should Trigger)
    outputs:
      triggered: ${{ steps.test.outputs.triggered }}
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6
      - uses: ./
        id: test
        with:
          triggers: ('.github/' 'action.yml' '.md')
          base_ref: ${{ inputs.base_ref || 'HEAD^' }}
          head_ref: ${{ inputs.head_ref || 'HEAD' }}

  test-false:
    name: Test False (Should Not Trigger)
    outputs:
      triggered: ${{ steps.test.outputs.triggered }}
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6
      - uses: ./
        id: test
        with:
          triggers: ('path/to/nowhere')
          base_ref: ${{ inputs.base_ref || 'HEAD^' }}
          head_ref: ${{ inputs.head_ref || 'HEAD' }}

  test-omitted:
    name: Test Omitted (Should Always Trigger)
    outputs:
      triggered: ${{ steps.test.outputs.triggered }}
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6
      - uses: ./
        id: test
        with:
          base_ref: ${{ inputs.base_ref || 'HEAD^' }}
          head_ref: ${{ inputs.head_ref || 'HEAD' }}

  results:
    name: Results
    needs: [test-true, test-false, test-omitted]
    runs-on: ubuntu-24.04
    steps:
      - name: Show Results
        run: |
          echo "Base ref: ${{ inputs.base_ref || 'HEAD^' }}"
          echo "Head ref: ${{ inputs.head_ref || 'HEAD' }}"
          echo "test-true.triggered: ${{ needs.test-true.outputs.triggered }} (expected: true)"
          echo "test-false.triggered: ${{ needs.test-false.outputs.triggered }} (expected: false)"
          echo "test-omitted.triggered: ${{ needs.test-omitted.outputs.triggered }} (expected: true)"
      
      - if:
          needs.test-true.outputs.triggered != 'true' ||
          needs.test-false.outputs.triggered != 'false' ||
          needs.test-omitted.outputs.triggered != 'true'
        run: |
          echo "âŒ Tests failed!"
          exit 1
      
      - if:
          needs.test-true.outputs.triggered == 'true' &&
          needs.test-false.outputs.triggered == 'false' &&
          needs.test-omitted.outputs.triggered == 'true'
        run: |
          echo "âœ… All tests passed!"
